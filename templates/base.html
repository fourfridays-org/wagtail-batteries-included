{% load navigation_tags static wagtailcore_tags wagtailuserbar %}
{% wagtail_site as current_site %}
<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en" data-bs-theme="light"> <!--<![endif]-->

<head>
    <meta charset="utf-8" />
    <title>
        {% block title %}{% if page.seo_title %}{{ page.seo_title }}{% else %}{{ page.title }}{% endif %}{% endblock %}
        {% block title_suffix %}{% if current_site and current_site.site_name %} | {{ current_site.site_name }}{% endif %}{% endblock %}
    </title>
    {% if self.search_description %}
    <meta name="description" content="{{ self.search_description }}" />{% endif %}
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    {% block extra_meta %}{% endblock %}

    <script>
        (() => {
            const storedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            const theme = storedTheme || (prefersDark ? 'dark' : 'light');
            document.documentElement.setAttribute('data-bs-theme', theme);
        })();
    </script>

    {% if self.seo_title == 'Home' %}
    <link rel="canonical" href="{{ page.full_url }}" />{% endif %}

    <link rel="shortcut icon" type="image/png" href="{% static 'favicon.ico' %}" />

    {# Global stylesheets #}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>

    <link rel="stylesheet" type="text/css" href="{% static 'css/base.min.css' %}" media="none" onload="media='all'">
    <noscript>
        <link rel="stylesheet" type="text/css" href="{% static 'css/base.min.css' %}">
    </noscript {% block head-extra %}{% endblock head-extra %} </head>

<body class="{% block body_class %}template-{{ self.get_verbose_name|slugify }}{% endblock %}">
    {% wagtailuserbar %}

    <header>
        {% block header %}
        {# Header contains the main_navigation block #}
        {% include "includes/header.html" with parent=site_root calling_page=self %}
        {% endblock header %}
    </header>

    <main class="my-4" role="main">
        {% block content %}{% endblock content %}
    </main>

    <!-- Footer -->
    <footer class="py-2 mt-4">
        {% include "includes/footer.html" %}
    </footer>

    {# Global javascript #}
    <script type="text/javascript" src="{% static 'js/base.min.js' %}" async></script>

    <script>
        (() => {
            const toggleButton = document.getElementById('theme-toggle');
            if (!toggleButton) return;

            const sunIcon = toggleButton.querySelector('[data-theme-icon="light"]');
            const moonIcon = toggleButton.querySelector('[data-theme-icon="dark"]');

            const getTheme = () => document.documentElement.getAttribute('data-bs-theme') || 'light';
            const setTheme = (theme) => {
                document.documentElement.setAttribute('data-bs-theme', theme);
                localStorage.setItem('theme', theme);
                const isDark = theme === 'dark';
                if (sunIcon) sunIcon.classList.toggle('d-none', !isDark);
                if (moonIcon) moonIcon.classList.toggle('d-none', isDark);
                toggleButton.setAttribute('aria-label', isDark ? 'Switch to light mode' : 'Switch to dark mode');
            };

            setTheme(getTheme());
            toggleButton.addEventListener('click', () => {
                setTheme(getTheme() === 'dark' ? 'light' : 'dark');
            });
        })();
    </script>

    {% block extra_js %}{% endblock %}
</body>

</html>